<ui-page [formGroup]="formState.form" (submitted)="onSubmit()">
  <ui-page-header>{{ title }}</ui-page-header>
  <ui-page-section>
    <ui-page-section-subheader icon="assignment" heading="Digital Evidence Case Management">
      <ng-container uiPageSectionSubheaderDesc>
        From this page you can request access to individual cases in the Digital Evidence and Disclosure Management
        System.
      </ng-container>

    </ui-page-section-subheader>
    <section>
      <ui-page-subheader>Case Search</ui-page-subheader>
      <p><i>Enter the case number to search for matching cases</i></p>
      <mat-form-field class="w-20">
        <input matInput placeholder="Agency Code" type="text" tabindex="1" (change)="onChangeAgencyCode()"
          formControlName="agencyCode" />
        <mat-error>Required</mat-error>
      </mat-form-field>

      <mat-form-field class="w-80">
        <mat-label>Case Name</mat-label>
        <input matInput autocomplete="off" formControlName="caseId" tabindex="2" [matAutocomplete]="auto" />
        <mat-autocomplete #auto="matAutocomplete" autocomplete="off">

        </mat-autocomplete>
        <mat-hint>
          Enter at least 3 characters
        </mat-hint>
      </mat-form-field>


    </section>
  </ui-page-section>


  <ui-page-section>
    <ui-page-section-subheader icon="assignment" heading="Case Listing">
    </ui-page-section-subheader>
    <ng-container uiPageSectionSubheaderDesc
      *ngIf="(identityProvider$ | async) == IdentityProvider.BCPS || (identityProvider$ | async) == IdentityProvider.IDIR">
      Here you can see the list of cases you are requesting access to and cases you currently have access to.
      <p *ngIf="caseListing.length === 0">
        <b>You have no currently assigned cases or requested cases.<br />
          Search for cases for them to be added.</b>
      </p>
      <table mat-table [dataSource]="dataSource">

        <ng-container matColumnDef="caseNumber">
          <th *matHeaderCellDef mat-header-cell>Case</th>
          <td *matCellDef="let case" mat-cell>{{ case.caseNumber }}</td>
        </ng-container>
        <ng-container matColumnDef="name">
          <th *matHeaderCellDef mat-header-cell>Name</th>
          <td *matCellDef="let case" mat-cell>{{ case.name }}</td>
        </ng-container>
        <ng-container matColumnDef="requestedDate">
          <th *matHeaderCellDef mat-header-cell>Requested Date</th>
          <td *matCellDef="let case" mat-cell>{{ case.requestedDate | date: 'MM-dd-yy' }}</td>
        </ng-container>
        <ng-container matColumnDef="assignedDate">
          <th *matHeaderCellDef mat-header-cell>Access Date</th>
          <td *matCellDef="let case" mat-cell>{{ case.assignedDate | date: 'MM-dd-yy' }}</td>
        </ng-container>
        <ng-container matColumnDef="status">
          <th *matHeaderCellDef mat-header-cell>Status</th>
          <td *matCellDef="let case" mat-cell class="centered-column capitalize"
            [ngClass]="{'pending': case.status === 'PENDING', 'active': case.status === 'ACTIVE' }">{{ case.status }}
          </td>
        </ng-container>
        <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
        <tr *matRowDef="let row; columns: displayedColumns" mat-row></tr>
      </table>

    </ng-container>

  </ui-page-section>

  <ui-page-footer [mode]="completed ? 'reverse' : 'normal'">
    <button mat-stroked-button uiPageFooterAction type="button" color="primary" (click)="onBack()">
      {{ completed || pending ? 'Back Home' : 'Cancel Back Home' }}
    </button>

    <button *ngIf="!(completed || pending)" mat-flat-button uiPageFooterAction type="button" color="primary"
      [disabled]="!formState.form.valid" (click)="onRequestAccess()">
      Save Changes
    </button>
  </ui-page-footer>

</ui-page>
